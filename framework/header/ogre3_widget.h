/****************************************************************************
**
** Copyright (C) 2016
**
** This file is generated by the Magus toolkit
**
** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
**
****************************************************************************/

#ifndef MAGUS_OGRE_WIDGET_H
#define MAGUS_OGRE_WIDGET_H

#include <QWidget>
#include <QPaintEngine>
#include "OgreRoot.h"
#include "OgreRenderWindow.h"
#include "OgreString.h"
#include "OgreCamera.h"
#include "OgreColourValue.h"
#include "OgreItem.h"
#include "ogre3_cameraman.h"
#include "ogre_prereqs.h"

namespace Magus
{
    static const Ogre::String AXIS_MATERIAL_NAME = "08945875681365184756348";

    class OgreManager;

    /****************************************************************************
    QT Ogre Window for Ogre > V2.0
    ***************************************************************************/
    class QOgreWidget : public QWidget
    {
        Q_OBJECT

        public:
            QOgreWidget(QWidget* parent = 0);
            virtual ~QOgreWidget(void);
            QPaintEngine* paintEngine() const; // Turn off QTs paint engine for the Ogre widget.
            void updateOgre(float timeSinceLastFrame);
            void createRenderWindow(OgreManager* ogreManager);
            void createScene();
            Ogre::Item* getItem(void) {return mItem;}
            void setItem(Ogre::Item* item, const Ogre::Vector3& scale);
            Ogre::RenderWindow* getRenderWindow(void) {return mOgreRenderWindow;}
            Ogre::SceneManager* getSceneManager(void) {return mSceneManager;}
            const Ogre::Vector3& getItemScale(void);
            void setItemScale(const Ogre::Vector3& scale);
            void setDefaultDatablockItem(void);
            void saveToFile(const Ogre::String& fileName);

            // Create item and use the current datablock of the previous item (if available)
            void createItem(const Ogre::String& itemName,
                            const Ogre::Vector3& scale);

            // Set the background colour
            void setBackgroundColour(const Ogre::ColourValue colour);

            void setRotateCameraMode (bool rotateCameraMode) {mRotateCameraMode = rotateCameraMode;}
            bool getRotateCameraMode (void) const {return mRotateCameraMode;}
            void enableLightItem(bool enabled); // Used to switch to ' light rotation mode'
            void createLightAxisMaterial(void); // Reset the material of the light axis item
            void setLightAxisMaterial(void); // Reset the material of the light axis item
            void destroyLightAxisMaterial(void);

        protected:
            Ogre::Root* mRoot;
            Ogre::RenderWindow* mOgreRenderWindow;
            Ogre::SceneManager* mSceneManager;
            Ogre::SceneManager* mSceneManagerTest;
            Ogre::Camera* mCamera;
            Ogre::ColourValue mBackground;
            Ogre::Real mTimeSinceLastFrame;
            CameraMan* mCameraManager;
            bool mSceneCreated;
            Ogre::Vector2 mAbsolute;
            Ogre::Vector2 mRelative;
            bool mSystemInitialized;
            Ogre::Item* mItem;
            Ogre::Item* mLightAxisItem;
            Ogre::SceneNode* mSceneNode;
            Ogre::SceneNode* mLightNode;
            Ogre::SceneNode* mLightAxisNode;
            Ogre::CompositorWorkspace* mWorkspace;
            bool mRotateCameraMode;
            bool mShiftDown;
            bool mMouseDown;
            Ogre::Light* mLight;

            virtual void createCompositor();
            virtual void paintEvent(QPaintEvent *e);
            virtual void resizeEvent(QResizeEvent *e);
            virtual void keyPressEvent(QKeyEvent * ev);
            virtual void keyReleaseEvent(QKeyEvent * ev);
            virtual void mouseMoveEvent(QMouseEvent* e);
            //virtual void mouseWheelEvent(QWheelEvent* e);
            virtual void wheelEvent(QWheelEvent* e);
            virtual void mousePressEvent(QMouseEvent* e);
            virtual void mouseReleaseEvent(QMouseEvent* e);
            HGLRC getCurrentGlContext(void);
            void rotateLight(Ogre::Vector2 relativeMouseMove);
    };
}

//****************************************************************************/
#endif // MAGUS_OGRE_WIDGET_H
