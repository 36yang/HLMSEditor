/****************************************************************************
**
** Copyright (C) 2016
**
** This file is generated by the Magus toolkit
**
** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
** "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
** LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
** A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
** OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
** LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
** DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
** (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
**
****************************************************************************/

// Include
#include "browser_dialog.h"

//****************************************************************************/
MaterialBrowserDialog::MaterialBrowserDialog(QWidget* parent, Qt::WindowFlags f) :
    QDialog(parent, f)
{
    setWindowTitle(QString("Material Browser"));
    QRect rec = QApplication::desktop()->screenGeometry();
    setMinimumWidth(0.7 * rec.width());
    setMaximumWidth(0.7 * rec.width());
    setMinimumHeight(0.8 * rec.height());
    setMaximumHeight(0.8 * rec.height());
    mSelectedFileName = "";

    // Create the Resource widget
    mResourceWidget = new Magus::QtResourceWidget(QString("../common/icons/"), this);
    connect(mResourceWidget, SIGNAL(jSonFileSelectedToProcess(QString)), this, SLOT(handleJsonFileSelectedToProcess(QString)));

    // Create a buttonbox
    QDialogButtonBox* buttonBox = new QDialogButtonBox(QDialogButtonBox::Ok | QDialogButtonBox::Cancel, this);
    connect(buttonBox, SIGNAL(accepted()), this, SLOT(handleOkAndAccept()));
    connect(buttonBox, SIGNAL(rejected()), this, SLOT(reject()));

    // Set the layout
    QHBoxLayout* buttonsLayout = new QHBoxLayout;
    buttonsLayout->addWidget(buttonBox);
    QVBoxLayout* mainLayout = new QVBoxLayout;
    mainLayout->addLayout(buttonsLayout);
    mainLayout->addWidget(mResourceWidget);
    setLayout(mainLayout);
}

//****************************************************************************/
MaterialBrowserDialog::~MaterialBrowserDialog(void)
{

}

//****************************************************************************/
void MaterialBrowserDialog::addMaterial(const QString& baseNameJson,
                                        const QString& fullNameJson,
                                        const QString& baseNameThumb,
                                        EditorHlmsTypes type)
{
    mResourceWidget->addMaterial(baseNameJson, fullNameJson, baseNameThumb, type);
}

//****************************************************************************/
QVector<Magus::QtResourceInfo*>& MaterialBrowserDialog::getResources (void)
{
    // Delegate to mResourceWidget
    return mResourceWidget->getResources();
}

//****************************************************************************/
void MaterialBrowserDialog::setResources (const QVector<Magus::QtResourceInfo*>& resources)
{
    mResourceWidget->setResources(resources);
}

//****************************************************************************/
void MaterialBrowserDialog::handleJsonFileSelectedToProcess(const QString& fullNameJson)
{
    mSelectedFileName = fullNameJson;
    accept();
}

//****************************************************************************/
void MaterialBrowserDialog::handleOkAndAccept(void)
{
    mSelectedFileName = mResourceWidget->getSelectedFullQualifiedName();
    accept();
}
